<%@ page contentType="text/html;charset=UTF-8" trimDirectiveWhitespaces="true"%>
<%@ include file="/WEB-INF/views/include/taglib.jsp"%>
<div class="navbar-buttons navbar-header pull-right collapse navbar-collapse" role="navigation">
	<ul class="nav ace-nav">
		<%--<li class="grey">
			<a data-toggle="dropdown" class="dropdown-toggle" href="#">
				<i class="ace-icon fa fa-tasks"></i>
				<span class="badge badge-grey">4</span>
			</a>

			<ul class="dropdown-menu-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close">
				<li class="dropdown-header">
					<i class="ace-icon fa fa-check"></i>
					4 Tasks to complete
				</li>

				<li class="dropdown-content">
					<ul class="dropdown-menu dropdown-navbar">
						<li>
							<a href="#">
								<div class="clearfix">
									<span class="pull-left">Software Update</span>
									<span class="pull-right">65%</span>
								</div>

								<div class="progress progress-mini">
									<div style="width:65%" class="progress-bar"></div>
								</div>
							</a>
						</li>

						<li>
							<a href="#">
								<div class="clearfix">
									<span class="pull-left">Hardware Upgrade</span>
									<span class="pull-right">35%</span>
								</div>

								<div class="progress progress-mini">
									<div style="width:35%" class="progress-bar progress-bar-danger"></div>
								</div>
							</a>
						</li>

						<li>
							<a href="#">
								<div class="clearfix">
									<span class="pull-left">Unit Testing</span>
									<span class="pull-right">15%</span>
								</div>

								<div class="progress progress-mini">
									<div style="width:15%" class="progress-bar progress-bar-warning"></div>
								</div>
							</a>
						</li>

						<li>
							<a href="#">
								<div class="clearfix">
									<span class="pull-left">Bug Fixes</span>
									<span class="pull-right">90%</span>
								</div>

								<div class="progress progress-mini progress-striped active">
									<div style="width:90%" class="progress-bar progress-bar-success"></div>
								</div>
							</a>
						</li>
					</ul>
				</li>

				<li class="dropdown-footer">
					<a href="#">
						See tasks with details
						<i class="ace-icon fa fa-arrow-right"></i>
					</a>
				</li>
			</ul>
		</li>
		
		<li class="purple">
			<a data-toggle="dropdown" class="dropdown-toggle" href="#">
				<i class="ace-icon fa fa-bell icon-animated-bell"></i>
				<span class="badge badge-important">8</span>
			</a>

			<ul class="dropdown-menu-right dropdown-navbar navbar-pink dropdown-menu dropdown-caret dropdown-close">
				<li class="dropdown-header">
					<i class="ace-icon fa fa-exclamation-triangle"></i>
					8 Notifications
				</li>

				<li class="dropdown-content">
					<ul class="dropdown-menu dropdown-navbar navbar-pink">
						<li>
							<a href="#">
								<div class="clearfix">
									<span class="pull-left">
										<i class="btn btn-xs no-hover btn-pink fa fa-comment"></i>
										New Comments
									</span>
									<span class="pull-right badge badge-info">+12</span>
								</div>
							</a>
						</li>

						<li>
							<a href="#">
								<i class="btn btn-xs btn-primary fa fa-user"></i>
								Bob just signed up as an editor ...
							</a>
						</li>

						<li>
							<a href="#">
								<div class="clearfix">
									<span class="pull-left">
										<i class="btn btn-xs no-hover btn-success fa fa-shopping-cart"></i>
										New Orders
									</span>
									<span class="pull-right badge badge-success">+8</span>
								</div>
							</a>
						</li>

						<li>
							<a href="#">
								<div class="clearfix">
									<span class="pull-left">
										<i class="btn btn-xs no-hover btn-info fa fa-twitter"></i>
										Followers
									</span>
									<span class="pull-right badge badge-info">+11</span>
								</div>
							</a>
						</li>
					</ul>
				</li>

				<li class="dropdown-footer">
					<a href="#">
						See all notifications
						<i class="ace-icon fa fa-arrow-right"></i>
					</a>
				</li>
			</ul>
		</li>

		<li class="green">
			<a data-toggle="dropdown" class="dropdown-toggle" href="#">
				<i class="ace-icon fa fa-envelope icon-animated-vertical"></i>
				<span class="badge badge-success">5</span>
			</a>

			<ul class="dropdown-menu-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close">
				<li class="dropdown-header">
					<i class="ace-icon fa fa-envelope-o"></i>
					5 Messages
				</li>

				<li class="dropdown-content">
					<ul class="dropdown-menu dropdown-navbar">
						<li>
							<a href="#" class="clearfix">
								<img src="${ctxStaticTheme}/avatars/avatar.png" class="msg-photo" alt="Alex's Avatar" />
								<span class="msg-body">
									<span class="msg-title">
										<span class="blue">Alex:</span>
										Ciao sociis natoque penatibus et auctor ...
									</span>

									<span class="msg-time">
										<i class="ace-icon fa fa-clock-o"></i>
										<span>a moment ago</span>
									</span>
								</span>
							</a>
						</li>

						<li>
							<a href="#" class="clearfix">
								<img src="${ctxStaticTheme}/avatars/avatar3.png" class="msg-photo" alt="Susan's Avatar" />
								<span class="msg-body">
									<span class="msg-title">
										<span class="blue">Susan:</span>
										Vestibulum id ligula porta felis euismod ...
									</span>

									<span class="msg-time">
										<i class="ace-icon fa fa-clock-o"></i>
										<span>20 minutes ago</span>
									</span>
								</span>
							</a>
						</li>

						<li>
							<a href="#" class="clearfix">
								<img src="${ctxStaticTheme}/avatars/avatar4.png" class="msg-photo" alt="Bob's Avatar" />
								<span class="msg-body">
									<span class="msg-title">
										<span class="blue">Bob:</span>
										Nullam quis risus eget urna mollis ornare ...
									</span>

									<span class="msg-time">
										<i class="ace-icon fa fa-clock-o"></i>
										<span>3:15 pm</span>
									</span>
								</span>
							</a>
						</li>

						<li>
							<a href="#" class="clearfix">
								<img src="${ctxStaticTheme}/avatars/avatar2.png" class="msg-photo" alt="Kate's Avatar" />
								<span class="msg-body">
									<span class="msg-title">
										<span class="blue">Kate:</span>
										Ciao sociis natoque eget urna mollis ornare ...
									</span>

									<span class="msg-time">
										<i class="ace-icon fa fa-clock-o"></i>
										<span>1:33 pm</span>
									</span>
								</span>
							</a>
						</li>

						<li>
							<a href="#" class="clearfix">
								<img src="${ctxStaticTheme}/avatars/avatar5.png" class="msg-photo" alt="Fred's Avatar" />
								<span class="msg-body">
									<span class="msg-title">
										<span class="blue">Fred:</span>
										Vestibulum id penatibus et auctor  ...
									</span>

									<span class="msg-time">
										<i class="ace-icon fa fa-clock-o"></i>
										<span>10:09 am</span>
									</span>
								</span>
							</a>
						</li>
					</ul>
				</li>

				<li class="dropdown-footer">
					<a href="#page/inbox">
						See all messages
						<i class="ace-icon fa fa-arrow-right"></i>
					</a>
				</li>
			</ul>
		</li> --%>
		<li class="green">
			<shiro:hasPermission name="sys:online:view"><c:set var="onlineAddTab" value="addTab"/></shiro:hasPermission>
			<a href="javascript:" data-href="${ctx}/sys/online/list" data-title="在线人员" title="在线人员" class="${onlineAddTab}">
				<i class="ace-icon fa fa-male icon-animated-vertical"></i>
				<span id="onlineCount" class="badge badge-success">0</span>
			</a>
			<script type="text/javascript">
				function refreshOnlineCount(){
					$.get('${ctx}/sys/online/count?__notUpdateSession=true', function(data){
						try{$('#onlineCount').html(Number(data))}catch(e){}
					})
				}
				refreshOnlineCount(); // 先执行一次
				setInterval(refreshOnlineCount, 180000); // 3分钟执行一次
			</script>
		</li>
		<c:if test="${fns:getModule('msg').isEnable && false}">
			<!-- BEGIN NOTIFICATION DROPDOWN -->
			<li class="purple">
				<a data-toggle="dropdown" class="dropdown-toggle" href="#" title="消息提醒">
					<i class="ace-icon fa fa-bell icon-animated-bell"></i>
					<span class="badge badge-important" id="msgNumber">0</span>
				</a>
				<ul class="dropdown-menu-right dropdown-navbar navbar-pink dropdown-menu dropdown-caret dropdown-close">
					<li class="dropdown-header">
						<i class="ace-icon fa fa-exclamation-triangle"></i>
						<span id="msgTitle">暂无最新消息<%-- 您还有 5 项未读消息 --%></span>
					</li>
					<li class="dropdown-content">
						<ul class="dropdown-menu dropdown-navbar navbar-pink" id="msgList"></ul>
					</li>
					<li class="dropdown-footer">
						<a href="javascript:" data-href="${ctx}/msg/message/list?status=6" data-title="消息管理" class="addTab">查看所有消息 <i class="ace-icon fa fa-arrow-right"></i></a>
					</li>
				</ul>
			</li>
			<!-- END NOTIFICATION DROPDOWN -->
		</c:if>
		
		<!-- #section:basics/navbar.user_menu -->
		<li class="light-blue">
			<a data-toggle="dropdown" href="#" class="dropdown-toggle">
				<c:set var="user" value="${fns:getUser()}"/>
				<c:if test="${not empty user.photo}">
					<img class="nav-user-photo" src="${user.photo}" />
				</c:if><c:if test="${empty user.photo}">
					<img class="nav-user-photo" src="${ctxStatic}/images/userinfo.jpg" />
				</c:if>
				<span class="user-info">
					<small>您好，</small>
					${user.userName}
				</span>
				<i class="ace-icon fa fa-caret-down"></i>
			</a>

			<ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
				<li>
					<a id="userInfo" href="javascript:" data-href="${ctx}/sys/user/info?qtype=0" class="addTab">
					<i class="ace-icon fa fa-user"></i> 个人信息 </a>
				</li>
				<li>
					<a id="modifyPassword" href="javascript:" data-href="${ctx}/sys/user/info?qtype=2" class="addTab">
					<i class="ace-icon fa fa-key"></i> 修改密码 </a>
				</li>
				<li class="divider"></li><!-- 
				<li>
					<a href="#">
					<i class="fa fa-lock"></i> 锁定屏幕 </a>
				</li> -->
				<li>
					<a href="${ctx}/logout">
					<i class="ace-icon fa fa-sign-out"></i> 退出登录 </a>
				</li>
				<c:if test="${user.superAdmin}">
					<li class="divider"></li>
					<li><a style="color:#888;">系统切换：</a></li>
					<c:set value="${fns:getPrincipal().params['sysCode']}" var="menuSysCode"></c:set>
					<c:forEach items="${fns:getDictList('menu_sys_code')}" var="dict">
						<li>
							<a href="${ctx}/index?sysCode=${dict.value}">
							<i class="ace-icon fa ${(empty menuSysCode and dict.value eq 'superAdmin') 
								or (menuSysCode eq dict.value) ? 'fa-check-circle-o' : 'fa-circle-o'}"></i> ${dict.name} </a>
						</li>
					</c:forEach>
				</c:if>
			</ul>
		</li>
		<!-- /section:basics/navbar.user_menu -->
	</ul>
</div>
<c:if test="${menuStyle eq '2'}">
	<div class="navbar-menu navbar-header pull-left collapse navbar-collapse" role="navigation">
	
		<%-- 一级菜单 --%>
		<c:set var="menuList" value="${fns:getMenuListByParentCode('0')}"/>
		<ul class="nav navbar-nav ${fn:length(menuList) eq 1 ? 'hide' : ''}">
			<c:choose>
				<c:when test="${fn:length(menuList) gt 6}">
					<c:forEach items="${menuList}" var="menu" begin="0" end="5">
						<c:if test="${menu.isMenu && menu.parentCode eq '0' && menu.isShow eq '1'}">
							<li>
								<a ${not empty menu.target ? '' : 'href="javascript:" data-'}href="${menu.url}" data-href2="${ctx}/sys/menu/tree?parentCode=${menu.menuCode}" 
									target="${not empty menu.target ? menu.target : ''}" class="${not empty menu.target ? '' : 'menu'}" data-id="${menu.menuCode}" style="color:${menu.color}">
									<i class="ace-icon ${not empty menu.icon ? menu.icon : 'fa fa-caret-right'}" style="color:${menu.color}"></i>
									${menu.name}
								</a>
							</li>
						</c:if>
					</c:forEach>
					 <li class="dropdown more">
		                <a href="#" class="dropdown-toggle" data-toggle="dropdown">更多<b class="caret"></b></a>
						<ul class="dropdown-menu">
							<c:forEach items="${menuList}" var="menu" begin="6" end="${fn:length(menuList) - 1}">
								<li>
									<a ${not empty menu.target ? '' : 'href="javascript:" data-'}href="${menu.url}" data-href2="${ctx}/sys/menu/tree?parentCode=${menu.menuCode}" 
										target="${not empty menu.target ? menu.target : ''}" class="${not empty menu.target ? '' : 'menu'}" data-id="${menu.menuCode}" style="color:${menu.color}">
										<i class="ace-icon ${not empty menu.icon ? menu.icon : 'fa fa-caret-right'}" style="color:${menu.color}"></i>
										${menu.name}
									</a>
								</li>
							</c:forEach>
						</ul>
					</li>
				</c:when>
				<c:otherwise>
					<c:forEach items="${menuList}" var="menu" varStatus="idxStatus">
						<c:if test="${menu.isMenu && menu.parentCode eq '0' && menu.isShow eq '1'}">
							<li>
								<a ${not empty menu.target ? '' : 'href="javascript:" data-'}href="${menu.url}" data-href2="${ctx}/sys/menu/tree?parentCode=${menu.menuCode}" 
									target="${not empty menu.target ? menu.target : ''}" class="${not empty menu.target ? '' : 'menu'}" data-id="${menu.menuCode}" style="color:${menu.color}">
									<i class="ace-icon ${not empty menu.icon ? menu.icon : 'fa fa-caret-right'}" style="color:${menu.color}"></i>
									${menu.name}
								</a>
							</li>
						</c:if>
					</c:forEach>
				</c:otherwise>
			</c:choose>
		</ul>
		<%-- 一级菜单 END --%>
		
		<!-- #section:basics/navbar.form - - >
		<form class="navbar-form navbar-left form-search" role="search">
			<div class="form-group">
				<input type="text" placeholder="search" />
			</div>
			<button type="button" class="btn btn-mini btn-info2">
				<i class="ace-icon fa fa-search icon-only bigger-110"></i>
			</button>
		</form>
		< ! - - /section:basics/navbar.form -->
	</div>
</c:if>